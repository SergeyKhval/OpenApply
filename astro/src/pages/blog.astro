---
import Layout from '../layouts/Layout.astro'
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import Breadcrumbs from "../components/Breadcrumbs.astro";

type PostModule = {
  url?: string;
  frontmatter: {
    title: string;
    description?: string;
    pubDate?: string;
    author?: string;
    tags?: string[];
  };
}

const posts = Object.values(import.meta.glob<PostModule>('./blog/*.md', { eager: true }))
  .sort((a, b) => {
    const dateA = a.frontmatter.pubDate ? new Date(a.frontmatter.pubDate).getTime() : 0;
    const dateB = b.frontmatter.pubDate ? new Date(b.frontmatter.pubDate).getTime() : 0;
    return dateB - dateA;
  });
const currentPath = Astro.url.pathname;

// SEO data
const pageTitle = "OpenApply Blog - Job Search Tips, Career Development & AI Tools";
const pageDescription = "Expert insights on job search strategies, LinkedIn optimization, resume building, cover letter writing, and leveraging AI tools to land your dream job faster.";
const canonicalUrl = new URL('/blog', Astro.site || 'https://openapply.app').href;
const keywords = "job search tips, career advice, LinkedIn optimization, resume tips, cover letter writing, AI job search, career development, job application strategies, job hunting";

// Structured Data - Blog/CollectionPage Schema
const blogSchema = {
  "@context": "https://schema.org",
  "@type": "Blog",
  "name": "OpenApply Blog",
  "description": pageDescription,
  "url": canonicalUrl,
  "publisher": {
    "@type": "Organization",
    "name": "OpenApply",
    "logo": {
      "@type": "ImageObject",
      "url": "https://openapply.app/favicon.ico"
    }
  },
  "blogPost": posts.map(post => ({
    "@type": "BlogPosting",
    "headline": post.frontmatter.title,
    "description": post.frontmatter.description || post.frontmatter.title,
    "url": new URL(post.url || '', Astro.site || 'https://openapply.app').href,
    "datePublished": post.frontmatter.pubDate ? new Date(post.frontmatter.pubDate).toISOString() : undefined,
    "author": {
      "@type": "Person",
      "name": post.frontmatter.author || "OpenApply Team"
    }
  }))
};

// Breadcrumb Schema
const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://openapply.app"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Blog",
      "item": canonicalUrl
    }
  ]
};

// Breadcrumb items for navigation
const breadcrumbItems = [
  { name: "Home", url: "/" },
  { name: "Blog", url: "/blog" }
];
---

<Layout
  title={pageTitle}
  description={pageDescription}
  keywords={keywords}
  canonicalUrl={canonicalUrl}
  ogType="website"
>
  <Header showHashLinks={false} currentPath={currentPath} />

  <!-- Structured Data -->
  <script type="application/ld+json" set:html={JSON.stringify(blogSchema)} />
  <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
  <main class="min-h-screen bg-background">
    <div class="container mx-auto px-4 py-12 max-w-4xl">
      <!-- Breadcrumbs -->
      <Breadcrumbs items={breadcrumbItems} />

      <h1 class="text-4xl md:text-5xl font-bold text-foreground mb-8">OpenApply Blog</h1>
      <p class="text-lg text-muted-foreground mb-12 max-w-3xl">
        Welcome to our blog! Here you'll find insights, tips, and updates about job applications, 
        career development, and how to make the most of OpenApply and AI tools to streamline your job search.
      </p>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        {posts.map((post) => (
          <article class="border border-border rounded-lg p-6 hover:border-primary transition-colors flex flex-col h-full">
            <a href={post.url} class="group flex flex-col h-full">
              <h2 class="text-xl font-bold text-foreground group-hover:text-primary transition-colors mb-3">
                {post.frontmatter.title}
              </h2>
              {post.frontmatter.description && (
                <p class="text-muted-foreground mb-4 text-sm line-clamp-3 flex-grow">{post.frontmatter.description}</p>
              )}
              <div class="mt-auto">
                <div class="flex flex-wrap gap-3 text-xs text-muted-foreground mb-3">
                  {post.frontmatter.pubDate && (
                    <time datetime={post.frontmatter.pubDate}>
                      {new Date(post.frontmatter.pubDate).toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                      })}
                    </time>
                  )}
                  {post.frontmatter.author && (
                    <span>by {post.frontmatter.author}</span>
                  )}
                </div>
                {post.frontmatter.tags && post.frontmatter.tags.length > 0 && (
                  <div class="flex flex-wrap gap-2">
                    {post.frontmatter.tags.map((tag) => (
                      <span class="px-2 py-1 text-xs font-medium bg-secondary text-secondary-foreground rounded-full">
                        {tag}
                      </span>
                    ))}
                  </div>
                )}
              </div>
            </a>
          </article>
        ))}
      </div>
    </div>
  </main>
  <Footer />
</Layout>